{"ast":null,"code":"import { isTag } from 'domhandler';\nimport { Picker } from 'selderee';\nfunction hp2Builder(nodes) {\n  return new Picker(handleArray(nodes));\n}\nfunction handleArray(nodes) {\n  const matchers = nodes.map(handleNode);\n  return function (el) {\n    for (var _len = arguments.length, tail = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      tail[_key - 1] = arguments[_key];\n    }\n    return matchers.flatMap(m => m(el, ...tail));\n  };\n}\nfunction handleNode(node) {\n  switch (node.type) {\n    case 'terminal':\n      {\n        const result = [node.valueContainer];\n        return function (el) {\n          return result;\n        };\n      }\n    case 'tagName':\n      return handleTagName(node);\n    case 'attrValue':\n      return handleAttrValueName(node);\n    case 'attrPresence':\n      return handleAttrPresenceName(node);\n    case 'pushElement':\n      return handlePushElementNode(node);\n    case 'popElement':\n      return handlePopElementNode(node);\n  }\n}\nfunction handleTagName(node) {\n  const variants = {};\n  for (const variant of node.variants) {\n    variants[variant.value] = handleArray(variant.cont);\n  }\n  return function (el) {\n    const continuation = variants[el.name];\n    for (var _len2 = arguments.length, tail = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      tail[_key2 - 1] = arguments[_key2];\n    }\n    return continuation ? continuation(el, ...tail) : [];\n  };\n}\nfunction handleAttrPresenceName(node) {\n  const attrName = node.name;\n  const continuation = handleArray(node.cont);\n  return function (el) {\n    for (var _len3 = arguments.length, tail = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n      tail[_key3 - 1] = arguments[_key3];\n    }\n    return Object.prototype.hasOwnProperty.call(el.attribs, attrName) ? continuation(el, ...tail) : [];\n  };\n}\nfunction handleAttrValueName(node) {\n  const callbacks = [];\n  for (const matcher of node.matchers) {\n    const predicate = matcher.predicate;\n    const continuation = handleArray(matcher.cont);\n    callbacks.push(function (attr, el) {\n      for (var _len4 = arguments.length, tail = new Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {\n        tail[_key4 - 2] = arguments[_key4];\n      }\n      return predicate(attr) ? continuation(el, ...tail) : [];\n    });\n  }\n  const attrName = node.name;\n  return function (el) {\n    for (var _len5 = arguments.length, tail = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n      tail[_key5 - 1] = arguments[_key5];\n    }\n    const attr = el.attribs[attrName];\n    return attr || attr === '' ? callbacks.flatMap(cb => cb(attr, el, ...tail)) : [];\n  };\n}\nfunction handlePushElementNode(node) {\n  const continuation = handleArray(node.cont);\n  const leftElementGetter = node.combinator === '+' ? getPrecedingElement : getParentElement;\n  return function (el) {\n    const next = leftElementGetter(el);\n    if (next === null) {\n      return [];\n    }\n    for (var _len6 = arguments.length, tail = new Array(_len6 > 1 ? _len6 - 1 : 0), _key6 = 1; _key6 < _len6; _key6++) {\n      tail[_key6 - 1] = arguments[_key6];\n    }\n    return continuation(next, el, ...tail);\n  };\n}\nconst getPrecedingElement = el => {\n  const prev = el.prev;\n  if (prev === null) {\n    return null;\n  }\n  return isTag(prev) ? prev : getPrecedingElement(prev);\n};\nconst getParentElement = el => {\n  const parent = el.parent;\n  return parent && isTag(parent) ? parent : null;\n};\nfunction handlePopElementNode(node) {\n  const continuation = handleArray(node.cont);\n  return function (el, next) {\n    for (var _len7 = arguments.length, tail = new Array(_len7 > 2 ? _len7 - 2 : 0), _key7 = 2; _key7 < _len7; _key7++) {\n      tail[_key7 - 2] = arguments[_key7];\n    }\n    return continuation(next, ...tail);\n  };\n}\nexport { hp2Builder };","map":{"version":3,"names":["isTag","Picker","hp2Builder","nodes","handleArray","matchers","map","handleNode","el","_len","arguments","length","tail","Array","_key","flatMap","m","node","type","result","valueContainer","handleTagName","handleAttrValueName","handleAttrPresenceName","handlePushElementNode","handlePopElementNode","variants","variant","value","cont","continuation","name","_len2","_key2","attrName","_len3","_key3","Object","prototype","hasOwnProperty","call","attribs","callbacks","matcher","predicate","push","attr","_len4","_key4","_len5","_key5","cb","leftElementGetter","combinator","getPrecedingElement","getParentElement","next","_len6","_key6","prev","parent","_len7","_key7"],"sources":["F:/scandiweb_store/frontend/node_modules/@selderee/plugin-htmlparser2/lib/hp2-builder.mjs"],"sourcesContent":["import { isTag } from 'domhandler';\nimport { Picker } from 'selderee';\n\nfunction hp2Builder(nodes) {\n    return new Picker(handleArray(nodes));\n}\nfunction handleArray(nodes) {\n    const matchers = nodes.map(handleNode);\n    return (el, ...tail) => matchers.flatMap(m => m(el, ...tail));\n}\nfunction handleNode(node) {\n    switch (node.type) {\n        case 'terminal': {\n            const result = [node.valueContainer];\n            return (el, ...tail) => result;\n        }\n        case 'tagName':\n            return handleTagName(node);\n        case 'attrValue':\n            return handleAttrValueName(node);\n        case 'attrPresence':\n            return handleAttrPresenceName(node);\n        case 'pushElement':\n            return handlePushElementNode(node);\n        case 'popElement':\n            return handlePopElementNode(node);\n    }\n}\nfunction handleTagName(node) {\n    const variants = {};\n    for (const variant of node.variants) {\n        variants[variant.value] = handleArray(variant.cont);\n    }\n    return (el, ...tail) => {\n        const continuation = variants[el.name];\n        return (continuation) ? continuation(el, ...tail) : [];\n    };\n}\nfunction handleAttrPresenceName(node) {\n    const attrName = node.name;\n    const continuation = handleArray(node.cont);\n    return (el, ...tail) => (Object.prototype.hasOwnProperty.call(el.attribs, attrName))\n        ? continuation(el, ...tail)\n        : [];\n}\nfunction handleAttrValueName(node) {\n    const callbacks = [];\n    for (const matcher of node.matchers) {\n        const predicate = matcher.predicate;\n        const continuation = handleArray(matcher.cont);\n        callbacks.push((attr, el, ...tail) => (predicate(attr) ? continuation(el, ...tail) : []));\n    }\n    const attrName = node.name;\n    return (el, ...tail) => {\n        const attr = el.attribs[attrName];\n        return (attr || attr === '')\n            ? callbacks.flatMap(cb => cb(attr, el, ...tail))\n            : [];\n    };\n}\nfunction handlePushElementNode(node) {\n    const continuation = handleArray(node.cont);\n    const leftElementGetter = (node.combinator === '+')\n        ? getPrecedingElement\n        : getParentElement;\n    return (el, ...tail) => {\n        const next = leftElementGetter(el);\n        if (next === null) {\n            return [];\n        }\n        return continuation(next, el, ...tail);\n    };\n}\nconst getPrecedingElement = (el) => {\n    const prev = el.prev;\n    if (prev === null) {\n        return null;\n    }\n    return (isTag(prev)) ? prev : getPrecedingElement(prev);\n};\nconst getParentElement = (el) => {\n    const parent = el.parent;\n    return (parent && isTag(parent)) ? parent : null;\n};\nfunction handlePopElementNode(node) {\n    const continuation = handleArray(node.cont);\n    return (el, next, ...tail) => continuation(next, ...tail);\n}\n\nexport { hp2Builder };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport * as React from \"rehackt\";\nimport { mergeDeepArray } from \"../../utilities/index.js\";\nimport { useApolloClient } from \"./useApolloClient.js\";\nimport { useSyncExternalStore } from \"./useSyncExternalStore.js\";\nimport { useDeepMemo, wrapHook } from \"./internal/index.js\";\nimport equal from \"@wry/equality\";\nexport function useFragment(options) {\n  return wrapHook(\"useFragment\", _useFragment, useApolloClient(options.client))(options);\n}\nfunction _useFragment(options) {\n  var cache = useApolloClient(options.client).cache;\n  var from = options.from,\n    rest = __rest(options, [\"from\"]);\n  // We calculate the cache id seperately from `stableOptions` because we don't\n  // want changes to non key fields in the `from` property to affect\n  // `stableOptions` and retrigger our subscription. If the cache identifier\n  // stays the same between renders, we want to reuse the existing subscription.\n  var id = React.useMemo(function () {\n    return typeof from === \"string\" ? from : cache.identify(from);\n  }, [cache, from]);\n  var stableOptions = useDeepMemo(function () {\n    return __assign(__assign({}, rest), {\n      from: id\n    });\n  }, [rest, id]);\n  // Since .next is async, we need to make sure that we\n  // get the correct diff on the next render given new diffOptions\n  var diff = React.useMemo(function () {\n    var fragment = stableOptions.fragment,\n      fragmentName = stableOptions.fragmentName,\n      from = stableOptions.from,\n      _a = stableOptions.optimistic,\n      optimistic = _a === void 0 ? true : _a;\n    return {\n      result: diffToResult(cache.diff(__assign(__assign({}, stableOptions), {\n        returnPartialData: true,\n        id: from,\n        query: cache[\"getFragmentDoc\"](fragment, fragmentName),\n        optimistic: optimistic\n      })))\n    };\n  }, [stableOptions, cache]);\n  // Used for both getSnapshot and getServerSnapshot\n  var getSnapshot = React.useCallback(function () {\n    return diff.result;\n  }, [diff]);\n  return useSyncExternalStore(React.useCallback(function (forceUpdate) {\n    var lastTimeout = 0;\n    var subscription = cache.watchFragment(stableOptions).subscribe({\n      next: function (result) {\n        // Since `next` is called async by zen-observable, we want to avoid\n        // unnecessarily rerendering this hook for the initial result\n        // emitted from watchFragment which should be equal to\n        // `diff.result`.\n        if (equal(result, diff.result)) return;\n        diff.result = result;\n        // If we get another update before we've re-rendered, bail out of\n        // the update and try again. This ensures that the relative timing\n        // between useQuery and useFragment stays roughly the same as\n        // fixed in https://github.com/apollographql/apollo-client/pull/11083\n        clearTimeout(lastTimeout);\n        lastTimeout = setTimeout(forceUpdate);\n      }\n    });\n    return function () {\n      subscription.unsubscribe();\n      clearTimeout(lastTimeout);\n    };\n  }, [cache, stableOptions, diff]), getSnapshot, getSnapshot);\n}\nfunction diffToResult(diff) {\n  var result = {\n    data: diff.result,\n    complete: !!diff.complete\n  };\n  if (diff.missing) {\n    result.missing = mergeDeepArray(diff.missing.map(function (error) {\n      return error.missing;\n    }));\n  }\n  return result;\n}","map":{"version":3,"names":["__assign","__rest","React","mergeDeepArray","useApolloClient","useSyncExternalStore","useDeepMemo","wrapHook","equal","useFragment","options","_useFragment","client","cache","from","rest","id","useMemo","identify","stableOptions","diff","fragment","fragmentName","_a","optimistic","result","diffToResult","returnPartialData","query","getSnapshot","useCallback","forceUpdate","lastTimeout","subscription","watchFragment","subscribe","next","clearTimeout","setTimeout","unsubscribe","data","complete","missing","map","error"],"sources":["C:/laragon/www/php_projects/scandiweb_store/frontend/node_modules/@apollo/client/react/hooks/useFragment.js"],"sourcesContent":["import { __assign, __rest } from \"tslib\";\nimport * as React from \"rehackt\";\nimport { mergeDeepArray } from \"../../utilities/index.js\";\nimport { useApolloClient } from \"./useApolloClient.js\";\nimport { useSyncExternalStore } from \"./useSyncExternalStore.js\";\nimport { useDeepMemo, wrapHook } from \"./internal/index.js\";\nimport equal from \"@wry/equality\";\nexport function useFragment(options) {\n    return wrapHook(\"useFragment\", _useFragment, useApolloClient(options.client))(options);\n}\nfunction _useFragment(options) {\n    var cache = useApolloClient(options.client).cache;\n    var from = options.from, rest = __rest(options, [\"from\"]);\n    // We calculate the cache id seperately from `stableOptions` because we don't\n    // want changes to non key fields in the `from` property to affect\n    // `stableOptions` and retrigger our subscription. If the cache identifier\n    // stays the same between renders, we want to reuse the existing subscription.\n    var id = React.useMemo(function () { return (typeof from === \"string\" ? from : cache.identify(from)); }, [cache, from]);\n    var stableOptions = useDeepMemo(function () { return (__assign(__assign({}, rest), { from: id })); }, [rest, id]);\n    // Since .next is async, we need to make sure that we\n    // get the correct diff on the next render given new diffOptions\n    var diff = React.useMemo(function () {\n        var fragment = stableOptions.fragment, fragmentName = stableOptions.fragmentName, from = stableOptions.from, _a = stableOptions.optimistic, optimistic = _a === void 0 ? true : _a;\n        return {\n            result: diffToResult(cache.diff(__assign(__assign({}, stableOptions), { returnPartialData: true, id: from, query: cache[\"getFragmentDoc\"](fragment, fragmentName), optimistic: optimistic }))),\n        };\n    }, [stableOptions, cache]);\n    // Used for both getSnapshot and getServerSnapshot\n    var getSnapshot = React.useCallback(function () { return diff.result; }, [diff]);\n    return useSyncExternalStore(React.useCallback(function (forceUpdate) {\n        var lastTimeout = 0;\n        var subscription = cache.watchFragment(stableOptions).subscribe({\n            next: function (result) {\n                // Since `next` is called async by zen-observable, we want to avoid\n                // unnecessarily rerendering this hook for the initial result\n                // emitted from watchFragment which should be equal to\n                // `diff.result`.\n                if (equal(result, diff.result))\n                    return;\n                diff.result = result;\n                // If we get another update before we've re-rendered, bail out of\n                // the update and try again. This ensures that the relative timing\n                // between useQuery and useFragment stays roughly the same as\n                // fixed in https://github.com/apollographql/apollo-client/pull/11083\n                clearTimeout(lastTimeout);\n                lastTimeout = setTimeout(forceUpdate);\n            },\n        });\n        return function () {\n            subscription.unsubscribe();\n            clearTimeout(lastTimeout);\n        };\n    }, [cache, stableOptions, diff]), getSnapshot, getSnapshot);\n}\nfunction diffToResult(diff) {\n    var result = {\n        data: diff.result,\n        complete: !!diff.complete,\n    };\n    if (diff.missing) {\n        result.missing = mergeDeepArray(diff.missing.map(function (error) { return error.missing; }));\n    }\n    return result;\n}\n//# sourceMappingURL=useFragment.js.map"],"mappings":"AAAA,SAASA,QAAQ,EAAEC,MAAM,QAAQ,OAAO;AACxC,OAAO,KAAKC,KAAK,MAAM,SAAS;AAChC,SAASC,cAAc,QAAQ,0BAA0B;AACzD,SAASC,eAAe,QAAQ,sBAAsB;AACtD,SAASC,oBAAoB,QAAQ,2BAA2B;AAChE,SAASC,WAAW,EAAEC,QAAQ,QAAQ,qBAAqB;AAC3D,OAAOC,KAAK,MAAM,eAAe;AACjC,OAAO,SAASC,WAAWA,CAACC,OAAO,EAAE;EACjC,OAAOH,QAAQ,CAAC,aAAa,EAAEI,YAAY,EAAEP,eAAe,CAACM,OAAO,CAACE,MAAM,CAAC,CAAC,CAACF,OAAO,CAAC;AAC1F;AACA,SAASC,YAAYA,CAACD,OAAO,EAAE;EAC3B,IAAIG,KAAK,GAAGT,eAAe,CAACM,OAAO,CAACE,MAAM,CAAC,CAACC,KAAK;EACjD,IAAIC,IAAI,GAAGJ,OAAO,CAACI,IAAI;IAAEC,IAAI,GAAGd,MAAM,CAACS,OAAO,EAAE,CAAC,MAAM,CAAC,CAAC;EACzD;EACA;EACA;EACA;EACA,IAAIM,EAAE,GAAGd,KAAK,CAACe,OAAO,CAAC,YAAY;IAAE,OAAQ,OAAOH,IAAI,KAAK,QAAQ,GAAGA,IAAI,GAAGD,KAAK,CAACK,QAAQ,CAACJ,IAAI,CAAC;EAAG,CAAC,EAAE,CAACD,KAAK,EAAEC,IAAI,CAAC,CAAC;EACvH,IAAIK,aAAa,GAAGb,WAAW,CAAC,YAAY;IAAE,OAAQN,QAAQ,CAACA,QAAQ,CAAC,CAAC,CAAC,EAAEe,IAAI,CAAC,EAAE;MAAED,IAAI,EAAEE;IAAG,CAAC,CAAC;EAAG,CAAC,EAAE,CAACD,IAAI,EAAEC,EAAE,CAAC,CAAC;EACjH;EACA;EACA,IAAII,IAAI,GAAGlB,KAAK,CAACe,OAAO,CAAC,YAAY;IACjC,IAAII,QAAQ,GAAGF,aAAa,CAACE,QAAQ;MAAEC,YAAY,GAAGH,aAAa,CAACG,YAAY;MAAER,IAAI,GAAGK,aAAa,CAACL,IAAI;MAAES,EAAE,GAAGJ,aAAa,CAACK,UAAU;MAAEA,UAAU,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,IAAI,GAAGA,EAAE;IAClL,OAAO;MACHE,MAAM,EAAEC,YAAY,CAACb,KAAK,CAACO,IAAI,CAACpB,QAAQ,CAACA,QAAQ,CAAC,CAAC,CAAC,EAAEmB,aAAa,CAAC,EAAE;QAAEQ,iBAAiB,EAAE,IAAI;QAAEX,EAAE,EAAEF,IAAI;QAAEc,KAAK,EAAEf,KAAK,CAAC,gBAAgB,CAAC,CAACQ,QAAQ,EAAEC,YAAY,CAAC;QAAEE,UAAU,EAAEA;MAAW,CAAC,CAAC,CAAC;IACjM,CAAC;EACL,CAAC,EAAE,CAACL,aAAa,EAAEN,KAAK,CAAC,CAAC;EAC1B;EACA,IAAIgB,WAAW,GAAG3B,KAAK,CAAC4B,WAAW,CAAC,YAAY;IAAE,OAAOV,IAAI,CAACK,MAAM;EAAE,CAAC,EAAE,CAACL,IAAI,CAAC,CAAC;EAChF,OAAOf,oBAAoB,CAACH,KAAK,CAAC4B,WAAW,CAAC,UAAUC,WAAW,EAAE;IACjE,IAAIC,WAAW,GAAG,CAAC;IACnB,IAAIC,YAAY,GAAGpB,KAAK,CAACqB,aAAa,CAACf,aAAa,CAAC,CAACgB,SAAS,CAAC;MAC5DC,IAAI,EAAE,SAAAA,CAAUX,MAAM,EAAE;QACpB;QACA;QACA;QACA;QACA,IAAIjB,KAAK,CAACiB,MAAM,EAAEL,IAAI,CAACK,MAAM,CAAC,EAC1B;QACJL,IAAI,CAACK,MAAM,GAAGA,MAAM;QACpB;QACA;QACA;QACA;QACAY,YAAY,CAACL,WAAW,CAAC;QACzBA,WAAW,GAAGM,UAAU,CAACP,WAAW,CAAC;MACzC;IACJ,CAAC,CAAC;IACF,OAAO,YAAY;MACfE,YAAY,CAACM,WAAW,CAAC,CAAC;MAC1BF,YAAY,CAACL,WAAW,CAAC;IAC7B,CAAC;EACL,CAAC,EAAE,CAACnB,KAAK,EAAEM,aAAa,EAAEC,IAAI,CAAC,CAAC,EAAES,WAAW,EAAEA,WAAW,CAAC;AAC/D;AACA,SAASH,YAAYA,CAACN,IAAI,EAAE;EACxB,IAAIK,MAAM,GAAG;IACTe,IAAI,EAAEpB,IAAI,CAACK,MAAM;IACjBgB,QAAQ,EAAE,CAAC,CAACrB,IAAI,CAACqB;EACrB,CAAC;EACD,IAAIrB,IAAI,CAACsB,OAAO,EAAE;IACdjB,MAAM,CAACiB,OAAO,GAAGvC,cAAc,CAACiB,IAAI,CAACsB,OAAO,CAACC,GAAG,CAAC,UAAUC,KAAK,EAAE;MAAE,OAAOA,KAAK,CAACF,OAAO;IAAE,CAAC,CAAC,CAAC;EACjG;EACA,OAAOjB,MAAM;AACjB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}